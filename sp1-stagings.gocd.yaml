---
format_version: 3
pipelines:
  SLE15.SP1.Stagings.RelPkgs:
    environment_variables:
      OSC_CONFIG: /home/go/config/oscrc-staging-bot
    group: SLE15.SP1.Stagings
    lock_behavior: unlockWhenFinished
    timer:
      spec: 0 */10 * ? * *
      only_on_changes: false
    materials:
      scripts:
        git: https://github.com/coolo/citest.git
    stages:
    - Generate.Release.Package:
        approval: manual
        jobs:
          "SLE.15.SP1.Staging.A":
            resources:
              - repo-checker
            tasks:
              - script: /usr/bin/osrt-pkglistgen -A https://api.suse.de update_and_solve
                 --staging SUSE:SLE-15-SP1:GA:Staging:A
                 --only-release-packages --force
          "SLE.15.SP1.Staging.B":
            resources:
              - repo-checker
            tasks:
              - script: /usr/bin/osrt-pkglistgen -A https://api.suse.de update_and_solve
                 --staging SUSE:SLE-15-SP1:GA:Staging:B
                 --only-release-packages --force
          "SLE.15.SP1.Staging.C":
            resources:
              - repo-checker
            tasks:
              - script: /usr/bin/osrt-pkglistgen -A https://api.suse.de update_and_solve
                 --staging SUSE:SLE-15-SP1:GA:Staging:C
                 --only-release-packages --force
          "SLE.15.SP1.Staging.D":
            resources:
              - repo-checker
            tasks:
              - script: /usr/bin/osrt-pkglistgen -A https://api.suse.de update_and_solve
                 --staging SUSE:SLE-15-SP1:GA:Staging:D
                 --only-release-packages --force
          "SLE.15.SP1.Staging.E":
            resources:
              - repo-checker
            tasks:
              - script: /usr/bin/osrt-pkglistgen -A https://api.suse.de update_and_solve
                 --staging SUSE:SLE-15-SP1:GA:Staging:E
                 --only-release-packages --force
          "SLE.15.SP1.Staging.F":
            resources:
              - repo-checker
            tasks:
              - script: /usr/bin/osrt-pkglistgen -A https://api.suse.de update_and_solve
                 --staging SUSE:SLE-15-SP1:GA:Staging:F
                 --only-release-packages --force
          "SLE.15.SP1.Staging.G":
            resources:
              - repo-checker
            tasks:
              - script: /usr/bin/osrt-pkglistgen -A https://api.suse.de update_and_solve
                 --staging SUSE:SLE-15-SP1:GA:Staging:G
                 --only-release-packages --force
          "SLE.15.SP1.Staging.H":
            resources:
              - repo-checker
            tasks:
              - script: /usr/bin/osrt-pkglistgen -A https://api.suse.de update_and_solve
                 --staging SUSE:SLE-15-SP1:GA:Staging:H
                 --only-release-packages --force
          "SLE.15.SP1.Staging.S":
            resources:
              - repo-checker
            tasks:
              - script: /usr/bin/osrt-pkglistgen -A https://api.suse.de update_and_solve
                 --staging SUSE:SLE-15-SP1:GA:Staging:S
                 --only-release-packages --force
          "SLE.15.SP1.Staging.V":
            resources:
              - repo-checker
            tasks:
              - script: /usr/bin/osrt-pkglistgen -A https://api.suse.de update_and_solve
                 --staging SUSE:SLE-15-SP1:GA:Staging:V
                 --only-release-packages --force
          "SLE.15.SP1.Staging.Y":
            resources:
              - repo-checker
            tasks:
              - script: /usr/bin/osrt-pkglistgen -A https://api.suse.de update_and_solve
                 --staging SUSE:SLE-15-SP1:GA:Staging:Y
                 --only-release-packages --force
  "SLE15.SP1.Staging.A":
    environment_variables:
      STAGING_PROJECT: SUSE:SLE-15-SP1:GA:Staging:A
      STAGING_API: https://api.suse.de
      OSC_CONFIG: /home/go/config/oscrc-staging-bot
      PYTHONPATH: /usr/share/openSUSE-release-tools
    group: SLE15.SP1.Stagings
    lock_behavior: unlockWhenFinished
    materials:
      scripts:
        git: https://github.com/coolo/citest.git
        destination: scripts
      stagings:
        git: http://botmaster.suse.de:4080/git/stagings.git
        destination: stagings
        whitelist:
          - SUSE:SLE-15-SP1:GA:Staging:A-standard.yaml
    stages:
    - "Check.Build.Succeeds":
        resources:
          - staging-bot
        tasks:
          - script: |-
              python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending

              if python -u ./scripts/rabbit-build.py -A $STAGING_API -p $STAGING_PROJECT -r standard; then
                 ## as the build id changed, we update the URL
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending
              else
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                 exit 1
              fi
    - "Update.000product":
        resources:
          - repo-checker
        tasks:
          - script: |-
              if /usr/bin/osrt-pkglistgen --debug -A $STAGING_API update_and_solve --staging $STAGING_PROJECT --force; then
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s success
              else
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                exit 1
              fi
  "SLE15.SP1.Staging.B":
    environment_variables:
      STAGING_PROJECT: SUSE:SLE-15-SP1:GA:Staging:B
      STAGING_API: https://api.suse.de
      OSC_CONFIG: /home/go/config/oscrc-staging-bot
      PYTHONPATH: /usr/share/openSUSE-release-tools
    group: SLE15.SP1.Stagings
    lock_behavior: unlockWhenFinished
    materials:
      scripts:
        git: https://github.com/coolo/citest.git
        destination: scripts
      stagings:
        git: http://botmaster.suse.de:4080/git/stagings.git
        destination: stagings
        whitelist:
          - SUSE:SLE-15-SP1:GA:Staging:B-standard.yaml
    stages:
    - "Check.Build.Succeeds":
        resources:
          - staging-bot
        tasks:
          - script: |-
              python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending

              if python -u ./scripts/rabbit-build.py -A $STAGING_API -p $STAGING_PROJECT -r standard; then
                 ## as the build id changed, we update the URL
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending
              else
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                 exit 1
              fi
    - "Update.000product":
        resources:
          - repo-checker
        tasks:
          - script: |-
              if /usr/bin/osrt-pkglistgen --debug -A $STAGING_API update_and_solve --staging $STAGING_PROJECT --force; then
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s success
              else
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                exit 1
              fi
  "SLE15.SP1.Staging.C":
    environment_variables:
      STAGING_PROJECT: SUSE:SLE-15-SP1:GA:Staging:C
      STAGING_API: https://api.suse.de
      OSC_CONFIG: /home/go/config/oscrc-staging-bot
      PYTHONPATH: /usr/share/openSUSE-release-tools
    group: SLE15.SP1.Stagings
    lock_behavior: unlockWhenFinished
    materials:
      scripts:
        git: https://github.com/coolo/citest.git
        destination: scripts
      stagings:
        git: http://botmaster.suse.de:4080/git/stagings.git
        destination: stagings
        whitelist:
          - SUSE:SLE-15-SP1:GA:Staging:C-standard.yaml
    stages:
    - "Check.Build.Succeeds":
        resources:
          - staging-bot
        tasks:
          - script: |-
              python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending

              if python -u ./scripts/rabbit-build.py -A $STAGING_API -p $STAGING_PROJECT -r standard; then
                 ## as the build id changed, we update the URL
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending
              else
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                 exit 1
              fi
    - "Update.000product":
        resources:
          - repo-checker
        tasks:
          - script: |-
              if /usr/bin/osrt-pkglistgen --debug -A $STAGING_API update_and_solve --staging $STAGING_PROJECT --force; then
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s success
              else
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                exit 1
              fi
  "SLE15.SP1.Staging.D":
    environment_variables:
      STAGING_PROJECT: SUSE:SLE-15-SP1:GA:Staging:D
      STAGING_API: https://api.suse.de
      OSC_CONFIG: /home/go/config/oscrc-staging-bot
      PYTHONPATH: /usr/share/openSUSE-release-tools
    group: SLE15.SP1.Stagings
    lock_behavior: unlockWhenFinished
    materials:
      scripts:
        git: https://github.com/coolo/citest.git
        destination: scripts
      stagings:
        git: http://botmaster.suse.de:4080/git/stagings.git
        destination: stagings
        whitelist:
          - SUSE:SLE-15-SP1:GA:Staging:D-standard.yaml
    stages:
    - "Check.Build.Succeeds":
        resources:
          - staging-bot
        tasks:
          - script: |-
              python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending

              if python -u ./scripts/rabbit-build.py -A $STAGING_API -p $STAGING_PROJECT -r standard; then
                 ## as the build id changed, we update the URL
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending
              else
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                 exit 1
              fi
    - "Update.000product":
        resources:
          - repo-checker
        tasks:
          - script: |-
              if /usr/bin/osrt-pkglistgen --debug -A $STAGING_API update_and_solve --staging $STAGING_PROJECT --force; then
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s success
              else
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                exit 1
              fi
  "SLE15.SP1.Staging.E":
    environment_variables:
      STAGING_PROJECT: SUSE:SLE-15-SP1:GA:Staging:E
      STAGING_API: https://api.suse.de
      OSC_CONFIG: /home/go/config/oscrc-staging-bot
      PYTHONPATH: /usr/share/openSUSE-release-tools
    group: SLE15.SP1.Stagings
    lock_behavior: unlockWhenFinished
    materials:
      scripts:
        git: https://github.com/coolo/citest.git
        destination: scripts
      stagings:
        git: http://botmaster.suse.de:4080/git/stagings.git
        destination: stagings
        whitelist:
          - SUSE:SLE-15-SP1:GA:Staging:E-standard.yaml
    stages:
    - "Check.Build.Succeeds":
        resources:
          - staging-bot
        tasks:
          - script: |-
              python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending

              if python -u ./scripts/rabbit-build.py -A $STAGING_API -p $STAGING_PROJECT -r standard; then
                 ## as the build id changed, we update the URL
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending
              else
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                 exit 1
              fi
    - "Update.000product":
        resources:
          - repo-checker
        tasks:
          - script: |-
              if /usr/bin/osrt-pkglistgen --debug -A $STAGING_API update_and_solve --staging $STAGING_PROJECT --force; then
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s success
              else
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                exit 1
              fi
  "SLE15.SP1.Staging.F":
    environment_variables:
      STAGING_PROJECT: SUSE:SLE-15-SP1:GA:Staging:F
      STAGING_API: https://api.suse.de
      OSC_CONFIG: /home/go/config/oscrc-staging-bot
      PYTHONPATH: /usr/share/openSUSE-release-tools
    group: SLE15.SP1.Stagings
    lock_behavior: unlockWhenFinished
    materials:
      scripts:
        git: https://github.com/coolo/citest.git
        destination: scripts
      stagings:
        git: http://botmaster.suse.de:4080/git/stagings.git
        destination: stagings
        whitelist:
          - SUSE:SLE-15-SP1:GA:Staging:F-standard.yaml
    stages:
    - "Check.Build.Succeeds":
        resources:
          - staging-bot
        tasks:
          - script: |-
              python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending

              if python -u ./scripts/rabbit-build.py -A $STAGING_API -p $STAGING_PROJECT -r standard; then
                 ## as the build id changed, we update the URL
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending
              else
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                 exit 1
              fi
    - "Update.000product":
        resources:
          - repo-checker
        tasks:
          - script: |-
              if /usr/bin/osrt-pkglistgen --debug -A $STAGING_API update_and_solve --staging $STAGING_PROJECT --force; then
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s success
              else
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                exit 1
              fi
  "SLE15.SP1.Staging.G":
    environment_variables:
      STAGING_PROJECT: SUSE:SLE-15-SP1:GA:Staging:G
      STAGING_API: https://api.suse.de
      OSC_CONFIG: /home/go/config/oscrc-staging-bot
      PYTHONPATH: /usr/share/openSUSE-release-tools
    group: SLE15.SP1.Stagings
    lock_behavior: unlockWhenFinished
    materials:
      scripts:
        git: https://github.com/coolo/citest.git
        destination: scripts
      stagings:
        git: http://botmaster.suse.de:4080/git/stagings.git
        destination: stagings
        whitelist:
          - SUSE:SLE-15-SP1:GA:Staging:G-standard.yaml
    stages:
    - "Check.Build.Succeeds":
        resources:
          - staging-bot
        tasks:
          - script: |-
              python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending

              if python -u ./scripts/rabbit-build.py -A $STAGING_API -p $STAGING_PROJECT -r standard; then
                 ## as the build id changed, we update the URL
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending
              else
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                 exit 1
              fi
    - "Update.000product":
        resources:
          - repo-checker
        tasks:
          - script: |-
              if /usr/bin/osrt-pkglistgen --debug -A $STAGING_API update_and_solve --staging $STAGING_PROJECT --force; then
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s success
              else
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                exit 1
              fi
  "SLE15.SP1.Staging.H":
    environment_variables:
      STAGING_PROJECT: SUSE:SLE-15-SP1:GA:Staging:H
      STAGING_API: https://api.suse.de
      OSC_CONFIG: /home/go/config/oscrc-staging-bot
      PYTHONPATH: /usr/share/openSUSE-release-tools
    group: SLE15.SP1.Stagings
    lock_behavior: unlockWhenFinished
    materials:
      scripts:
        git: https://github.com/coolo/citest.git
        destination: scripts
      stagings:
        git: http://botmaster.suse.de:4080/git/stagings.git
        destination: stagings
        whitelist:
          - SUSE:SLE-15-SP1:GA:Staging:H-standard.yaml
    stages:
    - "Check.Build.Succeeds":
        resources:
          - staging-bot
        tasks:
          - script: |-
              python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending

              if python -u ./scripts/rabbit-build.py -A $STAGING_API -p $STAGING_PROJECT -r standard; then
                 ## as the build id changed, we update the URL
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending
              else
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                 exit 1
              fi
    - "Update.000product":
        resources:
          - repo-checker
        tasks:
          - script: |-
              if /usr/bin/osrt-pkglistgen --debug -A $STAGING_API update_and_solve --staging $STAGING_PROJECT --force; then
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s success
              else
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                exit 1
              fi
  "SLE15.SP1.Staging.S":
    environment_variables:
      STAGING_PROJECT: SUSE:SLE-15-SP1:GA:Staging:S
      STAGING_API: https://api.suse.de
      OSC_CONFIG: /home/go/config/oscrc-staging-bot
      PYTHONPATH: /usr/share/openSUSE-release-tools
    group: SLE15.SP1.Stagings
    lock_behavior: unlockWhenFinished
    materials:
      scripts:
        git: https://github.com/coolo/citest.git
        destination: scripts
      stagings:
        git: http://botmaster.suse.de:4080/git/stagings.git
        destination: stagings
        whitelist:
          - SUSE:SLE-15-SP1:GA:Staging:S-standard.yaml
    stages:
    - "Check.Build.Succeeds":
        resources:
          - staging-bot
        tasks:
          - script: |-
              python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending

              if python -u ./scripts/rabbit-build.py -A $STAGING_API -p $STAGING_PROJECT -r standard; then
                 ## as the build id changed, we update the URL
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending
              else
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                 exit 1
              fi
    - "Update.000product":
        resources:
          - repo-checker
        tasks:
          - script: |-
              if /usr/bin/osrt-pkglistgen --debug -A $STAGING_API update_and_solve --staging $STAGING_PROJECT --force; then
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s success
              else
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                exit 1
              fi
  "SLE15.SP1.Staging.V":
    environment_variables:
      STAGING_PROJECT: SUSE:SLE-15-SP1:GA:Staging:V
      STAGING_API: https://api.suse.de
      OSC_CONFIG: /home/go/config/oscrc-staging-bot
      PYTHONPATH: /usr/share/openSUSE-release-tools
    group: SLE15.SP1.Stagings
    lock_behavior: unlockWhenFinished
    materials:
      scripts:
        git: https://github.com/coolo/citest.git
        destination: scripts
      stagings:
        git: http://botmaster.suse.de:4080/git/stagings.git
        destination: stagings
        whitelist:
          - SUSE:SLE-15-SP1:GA:Staging:V-standard.yaml
    stages:
    - "Check.Build.Succeeds":
        resources:
          - staging-bot
        tasks:
          - script: |-
              python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending

              if python -u ./scripts/rabbit-build.py -A $STAGING_API -p $STAGING_PROJECT -r standard; then
                 ## as the build id changed, we update the URL
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending
              else
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                 exit 1
              fi
    - "Update.000product":
        resources:
          - repo-checker
        tasks:
          - script: |-
              if /usr/bin/osrt-pkglistgen --debug -A $STAGING_API update_and_solve --staging $STAGING_PROJECT --force; then
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s success
              else
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                exit 1
              fi
  "SLE15.SP1.Staging.Y":
    environment_variables:
      STAGING_PROJECT: SUSE:SLE-15-SP1:GA:Staging:Y
      STAGING_API: https://api.suse.de
      OSC_CONFIG: /home/go/config/oscrc-staging-bot
      PYTHONPATH: /usr/share/openSUSE-release-tools
    group: SLE15.SP1.Stagings
    lock_behavior: unlockWhenFinished
    materials:
      scripts:
        git: https://github.com/coolo/citest.git
        destination: scripts
      stagings:
        git: http://botmaster.suse.de:4080/git/stagings.git
        destination: stagings
        whitelist:
          - SUSE:SLE-15-SP1:GA:Staging:Y-standard.yaml
    stages:
    - "Check.Build.Succeeds":
        resources:
          - staging-bot
        tasks:
          - script: |-
              python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending

              if python -u ./scripts/rabbit-build.py -A $STAGING_API -p $STAGING_PROJECT -r standard; then
                 ## as the build id changed, we update the URL
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s pending
              else
                 python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                 exit 1
              fi
    - "Update.000product":
        resources:
          - repo-checker
        tasks:
          - script: |-
              if /usr/bin/osrt-pkglistgen --debug -A $STAGING_API update_and_solve --staging $STAGING_PROJECT --force; then
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s success
              else
                python ./scripts/report-status.py -A $STAGING_API -p $STAGING_PROJECT -r standard -s failure
                exit 1
              fi
