format_version: 3
pipelines:
  openSUSE.Source.Check:
    group: openSUSE.Checkers
    lock_behavior: unlockWhenFinished
    timer:
      spec: 0 */5 * ? * *
    environment_variables:
      OSC_CONFIG: /home/go/config/oscrc-factory-auto
    materials:
      git:
        git: https://github.com/coolo/citest.git
    stages:
    - Run:
        approval:
          type: manual
        jobs:
          Run:
            timeout: 0
            resources:
            - staging-bot
            tasks:
            - script: /usr/bin/osrt-check_source -A https://api.opensuse.org --verbose --skip-add-reviews --group factory-auto review
  openSUSE.Repochecker:
    group: openSUSE.Checkers
    lock_behavior: unlockWhenFinished
    timer:
      spec: 0 */5 * ? * *
    environment_variables:
      OSC_CONFIG: /home/go/config/oscrc-repo-checker
    materials:
      git:
        git: https://github.com/coolo/citest.git
    stages:
    - Run:
        approval:
          type: manual
        jobs:
          Run:
            timeout: 0
            resources:
            - repo-checker
            tasks:
            - script: /usr/bin/osrt-repo_checker -A https://api.opensuse.org --debug review
  Project.Only:
    group: openSUSE.Checkers
    lock_behavior: unlockWhenFinished
    timer:
      spec: 0 0 * ? * *
      only_on_changes: false
    materials:
      git:
        git: https://github.com/coolo/citest.git
    stages:
    - Run:
        approval:
          type: manual
        environment_variables:
          OSC_CONFIG: /home/go/config/oscrc-repo-checker
        jobs:
          openSUSE_Factory:
            timeout: 0
            resources:
            - repo-checker
            tasks:
            - script: /usr/bin/osrt-repo_checker -A https://api.opensuse.org --debug project_only --post-comments openSUSE:Factory
          openSUSE_Leap_15_0_Update:
            timeout: 0
            resources:
            - repo-checker
            tasks:
            - script: /usr/bin/osrt-repo_checker -A https://api.opensuse.org --debug project_only --post-comments openSUSE:Leap:15.0:Update
          openSUSE_Leap_15_1:
            timeout: 0
            resources:
            - repo-checker
            tasks:
            - script: /usr/bin/osrt-repo_checker -A https://api.opensuse.org --debug project_only --post-comments openSUSE:Leap:15.1
          openSUSE_Leap_42_3_Update:
            timeout: 0
            resources:
            - repo-checker
            tasks:
            - script: /usr/bin/osrt-repo_checker -A https://api.opensuse.org --debug project_only --post-comments openSUSE:Leap:42.3:Update
  Factory.Staging.Bot.Regular:
    group: Factory.pkglistgen
    lock_behavior: unlockWhenFinished
    timer:
      spec: 0 0 * ? * *
    environment_variables:
      OSC_CONFIG: /home/go/config/oscrc-staging-bot
    materials:
      git:
        git: https://github.com/coolo/citest.git
    stages:
    - Run:
        approval:
          type: manual
        jobs:
          Run:
            timeout: 0
            resources:
            - staging-bot
            tasks:
            - script: osc -A https://api.opensuse.org staging -p openSUSE:Factory rebuild
            - script: osc -A https://api.opensuse.org staging -p openSUSE:Factory list --supersede
            - script: osc -A https://api.opensuse.org staging -p openSUSE:Factory adi --by-develproject
            - script: osc -A https://api.opensuse.org staging -p openSUSE:Factory select --non-interactive --merge --try-strategies
            - script: osc -A https://api.opensuse.org staging -p openSUSE:Factory unselect --cleanup
            - script: osc -A https://api.opensuse.org staging -p openSUSE:Factory repair --cleanup

